# 真实感图形学

## 概述

> 简单地说，就是希望用计算机生成像照相机拍的照片一样逼真的图形图像。
>
> 要实现这个目标，需要三部曲：
>
> 1. 建立三维场景（建模）；
> 2. 消隐解决物体深度的显示及确定物体之内的相互关系；
> 3. 在解决了消隐问题之后，在可见面上进行明暗光泽的处理，然后进行绘制（渲染）。

### 颜色模型

> **什么是颜色：**
>
> 1. 颜色是人的视觉系统对可见光的感知结果，感知到的颜色由光波的波长决定。
>
> 2. 人眼对于颜色的观察和处理是一种生理和心理现象，其机理还没有完全搞清楚。
> 3. 视觉系统能感觉的波长范围为380~780nm。
>
> **什么是颜色模型？**
>
> 1. 颜色模型（空间），是表示颜色的一种数学方法，人们用它来指定颜色和标定产生的颜色。通常用三个参数表小。
> 2. 几乎所有的颜色模型都是从RGB颜色模型导出
> 3. 目前现有颜色模型还没有一个完全符合人的视觉感知特性、颜色本身的物理特性或发光物体和光反射物体的特性。

#### 常用颜色模型

1. RGB颜色工业模型
2. 其它颜色工业模型
   - 主要用于彩色电视信号传输标准，主要有YIQ、YUV、 YCbCr彩色模型。
   - 三种彩色模型中，Y分量均代表黑白亮度分量，其余分量用于显示彩色信息。这样，只需利用Y分量进行图像显示，彩色图像就转换为灰度图像
3. 颜色视觉模型
   - 以上彩色模型是从色度学或硬件实现的角度提出的，但用色调（Hue）、饱和度（ Saturation，也称彩度）、亮度（Illumination）三要素来描述彩色空间能更好地与人的视觉特性相匹配。
     - 色调（Hue）：由物体反射光线中占优势的波长决定的，是彩色互相区分的基本特性。
     - 饱和度（ Saturation）或彩度：彩色的深浅程度，它取决于彩色中白色的含量。饱和度越高，彩色越深，白色光越少。
     - 亮度（Illumination）：光波作用于感受器所发生的效应，它取决于物体的反射系数。反射系数越大，物体亮度越大
4. 其他颜色视觉模型
   - HSV（hue, saturat ion and value彩色模型
     - A.R. Smith根据颜色的直观特性于1978年创建的，是颜色的倒六角锥体模型。
   - HSL与HSV
     - HSL采用亮度L（lightness）、HSV采用明度V（ value）作为坐标。

![10.1.1](img/10.1.1.jpg)

### 简单光照模型

> 1. 光照模型
>    - 当物体的几何形态确定之后，光照决定了整个场景的显示结果。因此，真实感图形的生成取决于如何建立个合适的光照模型（illumination model）。
> 2. 光照明模型：模拟物体表面的光照明物理现象的数学模型。
>    - 简单光照明模型只考虑光源对物体的直接光照

#### 背景物理知识

1. 光的传播规律反射定律
   - 入射角等于反射角，而且反射光线、入射光线与法向量在同一平面上。

2. 折射定律折射定律
   - 折射线在入射线与法线构成的平面上，折射角与入射角满足：

$$
{η_1\over η_2}={\sinφ \over \sinθ}
$$

![10.2.1](img/10.2.1.png)

3. 能量关系
   - 在光的反射和折射现象中的能量分布（满足能量守恒）

## Phong光照模型

### Phong光照模型（环境光+漫反射光+镜面反射光）

![10.2.2](img/10.2.2.png)

- 环境光
  - 邻近各物体所产生的光的多次反射最终达到平衡时的种光。可近似认为同一环境下的环境光，其光强分布是均匀的。
  - $I_{ambient}=I_aK_a~~~~I_a-环境光强度；K_a-环境光反射系数$

- 漫反射光

  - 光照射到比较粗糙的物体表面，物体表面某点的明暗程度不随观测者的位置变化，这种等同地向各个方向散射的现象称为光的漫反射。

  - 漫反射光强近似服从Lambert定律：

    $I_{diffuse}=I_pK_d(L·N)~~~~I_p-点光源光强；K_d-物体表面漫反射率$

- 镜面反射光

  - 光照射到相当光滑的物体表面，就产生镜面反射光，其特点是在光滑表面会产生高光区域。

  - 一般用Phong提出的经验模型表达：

    $I_{spec}=I_pK_s(R·V)^n~~~~I_p-点光源光强；K_s-物体表面某点的高光亮系数；n-镜面反射指数，1^2000，反映光滑程度$

得出Phong光照模型：
$$
I=I_{ambient}+I_{diffuse}+I_{spec}\\
=I_aK_a+I_pK_d(L·N)+I_pK_s(R·V)^n
$$
结合RGB颜色模型， Phong光照明模型最终有如下的形式：
$$
\begin{cases}
I_r=I_{ar}K_{ar}+I_{pr}K_{dr}(L·N)+I_{pr}K_{sr}(R·V)^n\\
I_g=I_{ag}K_{ag}+I_{pg}K_{dg}(L·N)+I_{pg}K_{sg}(R·V)^n\\
I_b=I_{ab}K_{ab}+I_{pb}K_{db}(L·N)+I_{pb}K_{sb}(R·V)^n
\end{cases}
$$

> Phong光照明模型是真实感图形学中提出的第一个有影响的光照明模型，生成图象的真实度已经达到可以接受的程度。
>
> Phone模型用来模拟光从物体表面到观察者眼睛的反射。尽管这种方法符合一些基本的物理法则，但它更多的是基于对现象的观察，所以被看成是一种经验式的方法。
>
> 在实际的应用中，由于Phonηg光照模型是一个经验模型，因此还具有以下的一些问题：
>
> - 显示出的物体象塑料，无质感变化
> - 没有考虑物体间相互反射光
> - 镜面反射颜色与材质无关
> - 镜面反射入射角大，会产生失真现象

## 增量式光照模型
> **为什么要进行明暗处理？**
>
> - 三维物体通常用多边形（三角形）来近似模拟。
> - 由于每一个多边形的法向一致，因而多边形内部的象素的颜色都是相同的，而且在不同法向的多边形邻接处，光强突变，使具有不同光强的两个相邻区域之间的光强不连续性（马赫带效应）。
>
> **如何进行明暗处理？**
>
> - 基本思想：每一个多边形的顶点处计算出光照强度或参数，然后在各个多边形内部进行均匀插值
> - 常用方法：
>   - Gouraud明暗处理（双线性光强插值算法）
>   - Phong明暗处理（双线性法向插值算法）

### Gouraud明暗处理

1. 计算多边形顶点的平均法向量
   与某个顶点相邻的所有多边形的法向平均值近似作为该顶点的近似法向量，顶点A相邻的多边形有k个，它的法向量计算为：

$$
N_a={1\over k}(N_1+N_2+…+N_k)
$$

2. 用Phong光照模型计算顶点的光强

   Phong光照模型出现前，采用如下光照模型计算：
   $$
   I=I_aK_a+I_pK_d(L·N_a)/(r+k)
   $$

3. 插值计算离散边上个点的光强

$$
I_A=uI_1+(1-u)I_2~~~~u={AV_2\over V_1V_2}\\
I_B=vI_1+(1-u)I_3~~~~v={BV_3\over V_1V_3}
$$

4. 插值计算多边形内域中各点的光强

$$
I_p=tI_A+(1-t)I_B~~~~t={PB\over AB}
$$

> 求任一点的光强需进行两次插值计算

- 为减少计算量，采用增量计算方法

$$
新扫描线：\begin{cases}
I_{A,j+1}=I_{A,j}+ΔI_A\\
I_{B,j+1}=I_{B,j}+ΔI_B\\
ΔI_A=(I_1-I_2)/(y_1-y_2)\\
ΔI_B=(I_1-I_3)/(y_1-y_3)
\end{cases}
$$

> Gouraud明暗处理有一个最大的缺点，就是不能有镜面反射光（高光）。
>
> 双线性插值是把能量往四周均匀，平均的结果就是光斑被扩大了，本来没有光斑的地方一插值反而出现了光斑。
>
> 解决办法：Phong明暗处理

### Phong明暗处理

> 与 Gouraud明暗处理有何不同？
>
> - 双线性光强插值>>双线性法向插值
> - 以时间为代价，引入镜面反射，解决高光问题

Phong明暗处理基本步骤：

1. 计算每个多边形顶点处的平均单位法矢量，这一步骤与Gour aud明暗处理方法的第一步相同。
2. 用双线性插值方法求得多边形内部各点的法矢量。
3. 最后按光照模型确定多边形内部各点的光强。

Phong明暗处理是先算角点的法向量，再算内部点的法向量最后再用新的光照模型算内部点的颜色值。

### 两种增量式光照模型比较

|                          Phong方法                           |                         Gouraud方法                          |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
| 1、产生的效果高光明显；<br/>2、高光多位于多边形内部；<br/>3、明暗变化缺乏层次感。 | 1、效果并不明显；<br/>2、多边形内部无高光；<br/>3、光强度变化均匀，与实际效果更接近。 |

- 增量式光照模型总结
  - 双线性光强插值（Gouraud模型）能有效的显示漫反射曲面，计算量小，速度快。
  - 双线性法向插值（Phong模型）可以产生正确的高光区域，但是计算量要大的多。
  - 增量式光照明模型的不足
    - 物体边缘轮廓是折线段而非光滑曲线
    - 等间距扫描线会产生不均匀效果
    - 插值结果取决于插值方向