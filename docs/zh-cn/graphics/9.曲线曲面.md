# 曲线曲面

## 曲线曲面基础

### 显示、隐式和参数表示

曲线和曲面的表示方程**有参数表示**和**非参数表示**之分，非参数表示又分为**显式表示**和**隐式表示**

> 对于一个平面曲线，显式表示一般形式是：$y=f(x)$
>
> 在此方程中，一个x值与一个y值对应，所以显式方程不能表示封闭或多值曲线
>
> 如果一个平面曲线方程，表示成$f(x,y)=0$的形式，称之为**隐式表示**。
>
> 隐式表示的优点是易于判断一个点是否在曲线上

显式或隐式表示存在的问题：

- 与坐标轴相关
- 用隐函数表示不直观，作图不方便
- 用显函数表示存在多值性
- 会出现斜率为无穷大的情形

### 参数方程

为了克服以上问题，曲线曲面方程通常表示成参数的形式

假定用t表示参数，平面曲线上任一点P可表示为：
$$
p(t)=[x(t),y(t)]
$$
空间曲线上任意三维点P可表示为：
$$
p(t)=[x(t),y(t),z(t)]
$$
它等价于笛卡儿分量表示：
$$
p(t)=x(t)i+y(t)j+z(t)k
$$
这样，给定一个t值，就得到**曲线上一点**的坐标。

------

假设曲线段对应的参数区间为$[a,b]$，即$a≤t≤b$。

为方便期间，可以将区间$[a,b]$规范化成$[0,1]$，参数变换为：
$$
t'={t-a\over b-a}
$$
参数**曲线**一般可写成：
$$
p=p(t),t∈[0,1]
$$
<br/>

类似地，可把**曲面**表示成为双参数u和v的矢量函数
$$
p(u,v)=p(x(u,v),y(u,v),z(u,v)),\space(u,v)∈[0,1]×[0,1]
$$
<br/>

最简单的参数曲线是**直线段**，端点为P1、P2的直线段参数方程可表示为：
$$
p(t)=p_1+(p_2-p_1)t,t∈[0,1]
$$

### 位置矢量

曲线上任一点的位置矢量可表示为：
$$
P(t)=[x(t),y(t),z(t)]
$$

### 切矢量

选择弧长s作为参数，当Δt→0时，弦长Δs→0，但方向不能趋向于0
$$
T={dP\over ds}=\lim_{Δs→0}{ΔP\over Δs}
$$
根据弧长微分公式有：
$$
(ds)^2=(dx)^2+(dy)^2+(dz)^2
$$
引入参数t，可改写为：
$$
({ds\over dt})^2=({dx\over dt})^2+({dy\over dt})^2+({dz\over dt})^2=|P'(t)|^2
$$

$$
T={dP\over ds}={dP\over dt}·{dt\over ds}={P'(t)\over |P'(t)|}
$$

即T是单位切矢量

### 曲率

切向量求导，求导以后还是一个向量，称为曲率，其几何意义是曲线的单位切向量对弧长的转动率，即刻画这一点的曲线的弯曲程度
$$
k=|T'|=\lim_{Δs→0}|{ΔT\over Δs}|=\lim_{Δs→0}|{T(s+Δs)-T(s)\over Δs}|=\lim_{Δs→0}|{Δθ\over Δs}|
$$
曲率越大，表示曲线的弯曲程度越大

曲率k的倒数$ρ={1\over k}$称为曲率半径。

曲率半径越大，圆弧越平缓；曲率半径越小，圆弧越陡。

### 法矢量

法矢量是与切矢量垂直的向量

N、B构成的平面称为法平面，N、T构成的平面称为密切平面，B、T构成的平面称为从切平面

![9.1.1](img/9.1.1.png)

T（切矢量）、N（主法矢量）和B（副法矢量）构成了曲线上的活动坐标架
$$
B=T×N
$$

### 挠率

空间曲线不但要弯曲，而且还要扭曲，即要离开它的密切平面。

为了能刻画这一扭曲程度，等价于去研究密切平面的法矢量（即曲线的副法矢量）关于弧长的变化率。

挠率$τ$的绝对值等于副法线方向（或密切平面）对于弧长的转动率
$$
|τ|=\lim_{Δs}|{Δθ\over Δs}|
$$

### 插值

自由曲线和自由曲面一般通过少数分散的点生成，这些点叫做“型值点”、“样本点”或“控制点”

给定一组有序的数据点$P_i(i=0,1,2，…n)$，要求构造一条曲线顺序通过这些数据点，称为对这些数据点进行插值(interpolation)，所构造的曲线称为插值曲线

1. 线性插值：假设给定函数$f(x)$在两个不同点x和x2的值，用一个线形函数：$y=ax+b$，近似代替，称为的线性插值函数
2. 抛物线插值：已知三个点的坐标，要求构造一个抛物线函数

### 拟合

构造一条曲线，使之在某种意义下最接近给定的数据点（但未必通过这些点），所构造的曲线为拟合曲线

> 在计算数学中，逼近通常指用一些性质较好的函数近似表示一些性质不好的函数。
>
> 在计算机图形学中，逼近继承了这方面的含义，因此插值和拟合都可以视为逼近

对于逼近样条，连接控制点序列的折线通常被显示出来，以提醒设计者控制点的次序

般将连接有一定次序控制点的直线序列称为控制多边形或特征多边形



### 光顺

指曲线的拐点不能太多（有一、二阶导数等）

对平面曲线而言，相对光顺的条件是

1. 具有二阶几何连续性（$G^2$）

2. 不存在多余拐点和奇异点

3. 曲率变化较小



## 曲线连续性

当许多参数曲线段首尾相连构成一条曲线时，如何保证各曲线段在连接处具有合乎要求的连续性是一个重要问题。

假定参数曲线段$p_i$以参数形式进行描述：
$$
p_i=p_i(t),t∈[t_{i0},t_{i1}]
$$
这里讨论参数曲线两种意义上的连续性：即**参数连续性**和**几何连续性**

### 参数连续性

- 0阶参数连续性

  记作$C^0$连续性，是指曲线的几何位置连接，即第一个曲线段在$t_{i1}$处的x,y,z值与第二个曲线段在$t_{(i+1)0}$处的x,y,z值相等

$$
p_i(t_{i1})=p_{(i+1)}(t_{(i+1)0})
$$

- 1阶参数连续性

  记作$C^1$连续性，指代表两个相邻曲线段的方程在相交点处有相同的一阶导数（切线）：

$$
p_i(t_{i1})=p_{(i+1)}(t_{(i+1)0})\\
且p'_i(t_{i1})=p'_{(i+1)}(t_{(i+1)0})
$$

一阶连续性对数字化绘画及一些设计应用已经足够

- 2阶参数连续性

  记作$C^2$连续性，指两个相邻曲线段的方程在相交点处具有相同的一阶和二阶导数。

  类似地，还可定义高阶参数连续性

对于$C^2$连续性，交点处的切向量变化率相等，即切线从一个曲线段平滑地变化到另一个曲线段

二阶连续性对电影中的动画途径和很多精密CAD需求有用

------

经典的参数连续性在图形学里是不适合的，因为太苛刻，所以引进了几何连续性的概念

汽车曲面的设计美观要求很高，但有时候车身的一条曲线并不是参数连连续的，但人眼看上去已经是很光滑的了，因此需要一种更弱的连续性

### 几何连续性

曲线段相连的另一个连续性条件是几何连续性。

与参数连续性不同的是，它只需曲线段在相交处的参数导数**成比例**即可

- 0阶几何连续性

  记作$G^0$连续性。与0阶参数连续性的定义相同，满足：

$$
p_i(t_{i1})=p_{(i+1)}(t_{(i+1)0})
$$

- 1阶几何连续性

  记作$G^1$连续性。若要求在结合处达到$G^1$连续就是说两条曲线在结合处在满足$G^0$连续的条件下，并有公共的切矢

$$
Q'(0)=αP'(1)\space(α>0)
$$

- 2阶几何连续性

  记作$G^2$连续性。就是说两条曲线在结合处在满足$G^1$连续的条件下，并有公共的曲率

!>**一阶导数相等和有公共切向量这两个概念差别是什么？**导数相等是大小方向都相等，而公共切矢意味着方向相同但大小不等。所谓参数连续意味着导数相等，导数相等意味着两个切向量，不但方向相等而且长度也相等。*条件减弱了*

## 参数化

> 过三点P、P1和P2构造参数表示的插值多项式是唯一的还是有多个呢？
>
> 插值多项式可以有无数条，这是因为对应地参数t在[0,1]中可以有无数种取法

$$
t_0=0,t_1={1\over 2},t_2=1
$$
$$
t_0=0,t_1={1\over 3},t_2=1
$$
$$
参数方程:\begin{cases}
x(t)=a_1t^2+a_2t+a_3\\
y(t)=b_1t^2+b_2t+b_3
\end{cases}
$$
插值问题实际上就是解方程组的问题。但如果参数取的不一样的话，结果是不一样的

每个参数值称为节点(knot)。对于一条插值曲线，$p_0、 p_1、p_2$这些点称为型值点

对于一条插值曲线，型值点$p_0,p_1,…,p_n$。与其参数域$t∈[t_0，t_1]$内的节点之间有一种对应关系。对于一组有序的型值点，所确定一种参数分割，称之这组型值点的参数化

------

**例：**现在给定3个点$p_0、p_1、p_2$，坐标是$(0,0)、(100,50)、(200,0)$，求一条2次的多项式曲线来插值这三个点。

![9.3.1](img/9.3.1.png)

假设第一个点参数$t=0$，第二个点参数取$t={1\over 2}$，第三个点的参数取$t=1$。

即$t_1=0,t_2={1\over 2},t_3=1$，带入参数方程$\begin{cases}x(t)=a_1t^2+a_2t+a_3\\y(t)=b_1t^2+b_2t+b_3\end{cases}$

得到：$\begin{cases}0=x(0)=a_3\\0=y(0)=b_3\end{cases}\\
\begin{cases}100=x({1\over 2})={a_1\over 4}+{a_2\over 2}+a_3\\50=y({1\over 2})={b_1\over 4}+{b_2\over 2}+b_3\end{cases}\\
\begin{cases}200=x(1)=a_1+a_2+a_3\\0=y(1)=b_1+b_2+b_3\end{cases}$

6个方程6个未知数，插值问题的本质是方程的个数和未知数的个数是一致的

!>**为何取参数$t_1=0,t_2={1\over 2},t_3=1$？**因为要使参数更接近/符合点的分布。参数化的本质就是找一组恰当的参数t来匹配这一组不同的型值点。给定一组不同的型值点，就要给出不同的参数化即不同的t值，这样才使得这条曲线美观、合理。

> **参数化常用方法：**
>
> 1. 均匀参数化
>
>    节点在参数轴上呈等距分布。如$0、{1\over 10}、{2\over 10}…$
>
> 2. 累加弦长参数化（根据长度的比例关系来确定t）
>
>    $\begin{cases}t_0=0\\t_i=t_{i-1}+|ΔP_{i-1}|,i=1,2,…,n\end{cases};ΔP_i=P_{i+1}-P_i$
>    
>    这种参数法如实反映了型值点按弦长的分布情况，能够克服型值点按弦长分布不均匀的情况下采用均匀参数化所岀现的问题
>    
> 3. 向心参数化法
>
>    $\begin{cases}t_0=0\\t_i=t_{i-1}+|ΔP_{i-1}|^{1\over 2},i=1,2,…,n\end{cases};ΔP_i=P_{i+1}-P_i$
>
>    向心参数化法假设在一段曲线弧上的向心力与曲线切矢从该弧段始端至末端的转角成正比，加上一些简化假设，得到向心参数化法。此法尤其适用于非均匀型值点分布

## 参数曲线的代数和几何形式

以**三次参数曲线**为例，讨论参数曲线的代数和几何形式

1. 代数形式
$$
\begin{cases}
x(t)=a_{3x}t^3+a_{2x}t^2+a_{1x}t+a_{0x}\\
y(t)=b_{3y}t^3+b_{2y}t^2+b_{1y}t+b_{0y}\\
z(t)=c_{3z}t^3+c_{2z}t^2+c_{1z}t+c_{0z}\\
\end{cases},t∈[0,1]
$$

上述代数式写成矢量式是：
$$
P(t)=a_3t^3+a_2t^2+a_1t+a_0,t∈[0,1]
$$

!> **注意：**$a_3，a_2，a_1，a$是参数曲线的系数，但记住不是常数而是向量。$a_3$对应刚才的$a_{3x}$、$a_{3y}$、$a_{3z}$。改变系数曲线如何变化是不清楚的，这是代数形式的缺点

2. 几何形式

几何形式是利用一条曲线端点的几何性质来刻画一条曲线。所谓端点的几何性质，就是指曲线的端点位置、切向量、各阶导数等端点的信息。

将$P(0)$、$P(1)$、$P'(0)$和$P'(1)$简记为：$P_0、P_1、P'_0、P'_1$
$$
P(t)=a_3t^3+a_2t^2+a_1t+a_0,t∈[0,1]
$$
得到：$\begin{cases}P_0=a+0\\P_1=a_3+a_2+a_1+a_0\\P'_0=a_1\\P'_1=3a_3+2a_2+a_1\end{cases}\implies
\begin{cases}a_0=P_0\\a_1=P'_0\\a_2=-3P_0-3P_1-2P'_0-P'_0\\a_3=2P_0-2P_1+P'_0+P'_1\end{cases}$

再代入$P(t)=a_3t^3+a_2t^2+a_1t+a_0$

得：$P(t)=(2t^3-3t^2+1)p_0+(-2t^3+3t^2)p_1+(t^3-2t^2-t)p'_0+(t^3-t^2)p'_1$

对上式化简，令：
$$
F(0)=2t^3-3t^2+1，F(1)=-2t^3+3t^2\\
G(0)=t^3-2t^2-t，G(1)=t^3-t^2
$$
简化后得：
$$
{\color{red}*}P(t)=F_0P_0+F_1P_1+G_0P'_0+G_1P'_1,t∈[0,1]
$$
上式是三次**Hermite曲线**（三次哈密特曲线）的几何形式，几何系数是$P_0、P_1、P'_0、P'_1$；$F(0)、F(1)、G(O)、G(1)$称为调和函数（或混合函数）

## Bezier曲线与曲面

> 想法基点是在进行汽车外形设计时，先用折线段勾画出汽车的外形大致轮廓，然后用光滑的参数曲线去逼近这个折线多边形
>
> 这个折线多边形被称为**特征多边形**。
>
> 逼近该特征多边形的曲线被称为Bezier曲线。

### 定义

针对Bezier曲线，给定空间n+1个点的位置矢量P_i

贝塞尔把参数n次曲线表示为：
$$
p(t)=\displaystyle\sum_{i=0}^na_if_{i,n}(t)，0≤t≤1
$$
其中系数矢量$a_i(i=0,1,…n)$顺序首尾相接，从$a_0$的末端到$a_n$的末端所形成的折线称为控制多边形或贝塞尔多边形
$$
f_{i,n}(t)=\begin{cases}
1,i=0\\
{(-t)^i\over(i-1)!}{{d^{i-1}\over dt^{i-1}}({(1-t)^{n-1}-1\over t})}
\end{cases}称为贝塞尔基函数
$$
上式可以简化成**伯恩斯坦基函数**：
$$
B_{i,n}(t)={n!\over i!(n-i)!}t^i(1-t)^{n-i}=C_n^it^i(1-t)^{n-i},(i=0,1,…,n)
$$

$C_n^it^i(1-t)^{n-i}$正是牛顿二项式定理

### 一次Bezier曲线

当n=1时，有两个控制点$p_0$和$p_1$，Bezier多项式是一次多项式：
$$
p(t)=\displaystyle\sum_{i=0}^1a_if_{i,1}(t)
=P_0B_{0,1}(t)+P_1B_{1,1}(t)
$$

$$
\begin{cases}
B_{0,1}(t)={1!\over 0!(1-0)!}t^0(1-t)^{1-0}=1-t\\
B_{1,1}(t)={1!\over 1!(1-1)!}t^1(1-t)^{1-1}=t
\end{cases}
$$

因此：
$$
p(t)=\displaystyle\sum_{i=0}^1a_if_{i,1}(t)
=P_0B_{0,1}(t)+P_1B_{1,1}(t)\\
=(1-t)P_0+tP_1
$$
这恰好是连接起点$P_0$和终点$p_1$的直线段

### 二次Bezier曲线

当n=2时，有3个控制点$p_0、p_1和p_2$，Bezier多项式是二次多项式：
$$
p(t)=\displaystyle\sum_{i=0}^2a_if_{i,2}(t)
=P_0B_{0,2}(t)+P_1B_{1,2}(t)+P_2B_{2,2}(t)
$$

$$
\begin{cases}
B_{0,2}(t)={2!\over 0!(2-0)!}t^0(1-t)^{2-0}=(1-t)^2\\
B_{1,2}(t)={2!\over 1!(2-1)!}t^1(1-t)^{2-1}=2t(1-t)\\
B_{2,2}(t)={2!\over 2!(2-2)!}t^2(1-t)^{2-2}=t^2
\end{cases}
$$

因此：
$$
p(t)=\displaystyle\sum_{i=0}^2a_if_{i,2}(t)
=P_0B_{0,2}(t)+P_1B_{1,2}(t)+P_2B_{2,2}(t)\\
=(1-t)^2P_0+2t(1-t)P_1+t^2P_2\\
=(P_2-2P_1+P_0)t^2+2(P_1-P_0)t+P_0
$$
二次Bezier曲线为抛物线，其矩阵形式为：
$$
p(t)=\begin{bmatrix}
t^2 & t & 1
\end{bmatrix}·
\begin{bmatrix}
1 & -2 & 1\\
-2 & 2 & 0\\
1 & 0 & 0
\end{bmatrix}·
\begin{bmatrix}
P_0\\P_1\\P_2
\end{bmatrix},t∈[0,1]
$$

### 三次Bezier曲线

三次Bezier曲线由4个控制点生成，这时n=3，有4个控制点$p_0、p_1、p_2$和$p_3$，Bezier多项式是三次多项式：
$$
p(t)=\displaystyle\sum_{i=0}^3a_if_{i,3}(t)
=P_0B_{0,3}(t)+P_1B_{1,3}(t)+P_2B_{2,3}(t)+P_3B_{3,3}(t)
$$

$$
\begin{cases}
B_{0,3}(t)={3!\over 0!(2-0)!}t^0(1-t)^{3-0}=(1-t)^3\\
B_{1,3}(t)={3!\over 1!(2-1)!}t^1(1-t)^{3-1}=3t(1-t)^2\\
B_{2,3}(t)={3!\over 2!(2-2)!}t^2(1-t)^{3-2}=3t^2(1-t)\\
B_{2,3}(t)={3!\over 3!(2-2)!}t^3(1-t)^{3-3}=t^3
\end{cases}，为三次Bezier曲线的基函数
$$

因此：
$$
p(t)=\displaystyle\sum_{i=0}^3a_if_{i,3}(t)
=(1-t^3)P_0+3t(1-t)^2P_1+3t^2(1-t)P_2+t^3P_3
$$
这四条基函数曲线均是三次曲线，任何三次Bezier曲线都是这四条曲线的线形组合

把 Bezier三次曲线多项式写成矩阵形式：
$$
p(t)=\begin{bmatrix}
t^3 & t^2 & t & 1
\end{bmatrix}·
\begin{bmatrix}
-1 & 3 & -3 & 1\\
3 & -6 & 3 & 0\\
-3 & 3 & 0 & 0\\
1 & 0 & 0 & 0
\end{bmatrix}·
\begin{bmatrix}
P_0\\P_1\\P_2\\P_3
\end{bmatrix},t∈[0,1]\\
=T·M_{be}·G_{be}\\
$$
其中，$M_{be}$是三次Bezier曲线系数矩阵，为常数；$G_{be}$是4个控制点位置矢量

!> Bezier曲线不可能对曲线形状进行局部控制，如果改变任一控制点位置，整个曲线会受到影响

### Bernstein基函数的性质

1. 正性（非负性）
2. 权性
   - 基函数有n+1项，n+1个基函数的和加起来正好等1
3. 端点性质
4. 对称性
   - 可以证明，假如保持n次 Bezier曲线控制多边形的顶点位置不变，而把次序颠倒过来，则此时曲线仍不变，只不过曲线的走向相反而已
5. 递推性
   - 即n次的Bernstein基函数可由两个n-1次的 Bernstein基函数线性组合而成。
6. 导函数
   - $B'_{i,n}(t)=n[B_{{i-1},{n-1}}(t)-B_{i,{n-1}}(t)],i=0,1,…,n$
7. 最大值
   - $B_{i,n}(t)$在$t={i\over n}$处达到最大值
8. 积分
   - $\int^1_0B_{i,n}(t)dt={1\over n+1}$
9. 降阶公式
   - $B_{i,n}(u)=(1-u)B_{i,{n-l}}(u)+uB_{{i-l},{n-l}}(u)$
   - 一个n次Bernstein基函数能表示成两个n-1次基函数的线性和
10. 升阶公式

### Bezier曲线的性质

1. 端点性质
   - 顶点$p_0$和$p_n$分别位于实际曲线段的起点和终点上
2. 一阶导数
   - Bezier曲线的起点和终点处的切线方向和特征多边形的第一条边及最后一条边的走向一致
3. 几何不变性
   - 指某些几何特性不随坐标变换而变化的特性。Bezier曲线的形状仅与控制多边形各顶点的相对位置有关，而与坐标系的的选择无关
4. 变差缩减性
   - 若Bezier曲线的特征多边形是一个平面图形，则平面内任意直线与p(t)的交点个数不多于该直线与其特征多边形的交点个数，这一性质叫变差缩减性质