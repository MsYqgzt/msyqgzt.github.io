# 关系代数

> 1. 传统的集合运算，包括并、交、差。
> 2. 专门的关系运算，包括对关系进行
>    - 垂直分割（投影）
>    - 水平分割（选择）
>    - 关系的结合（连接、自然连接）等

## 基本操作

### 并（Union）

设关系R和S具有相同的关系模式，R和S的并是由属于R或属于S的所有元组构成的集合，记为R∪S。

形式定义如下：
$$
R∪S=\{t|t\in R \lor t\in S\}
$$

关系的并操作对应于关系的插入或添加记录的操作，俗称“+”操作，是关系代数的基本操作。

例：

|       |   R   |       |      |       |   S   |       |      |       |  R∪S  |       |
| :---: | :---: | :---: | :--: | :---: | :---: | :---: | :--: | :---: | :---: | :---: |
| **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |
|  x1   |  y1   |  z1   |      |  x1   |  y1   |  z2   |      |  x1   |  y1   |  z1   |
|  x1   |  y3   |  z2   |      |  x1   |  y3   |  z2   |      |  x1   |  y3   |  z2   |
|  x2   |  y3   |  z3   |      |  x2   |  y3   |  z3   |      |  x1   |  y1   |  z2   |
|       |       |       |      |       |       |       |      |  x2   |  y3   |  z3   |



### 差（Difference）

设关系R和S具有相同的关系模式，R和S的差是由属于R但不属于S的元组构成的集合，记为R-S。

形式定义如下：
$$
R-S=\{t|t \in R \land t \in S \}
$$
关系的差操作对应于关系的删除记录的操作，俗称“-”操作，是关系代数的基本操作。

例：

|       |   R   |       |      |       |   S   |       |      |       |  R-S  |       |
| :---: | :---: | :---: | :--: | :---: | :---: | :---: | :--: | :---: | :---: | :---: |
| **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |
|  x1   |  y1   |  z1   |      |  x1   |  y1   |  z2   |      |  x1   |  y1   |  z1   |
|  x1   |  y3   |  z2   |      |  x1   |  y3   |  z2   |      |       |       |       |
|  x2   |  y3   |  z3   |      |  x2   |  y3   |  z3   |      |       |       |       |



### 笛卡尔积（Extended Cartesian Product）

设关系R和S的属性个数（即列数）分别为r和s，R和S的笛卡儿积是一个（r+s）列的元组集合，每个元组的前r个列来自R的一个元组，后s个列来自S的一个元组，记为R×S。形式定义如下：
$$
R{\color{red}×}S=\{\hat{{t_r}{t_s}}|t \in R \land t \in S\}
$$
关系的广义笛卡尔积操作对应于两个关系记录横向合并的操作，俗称“”操作，是关系代数的基本操作。

|       |   R   |       |      |       |   S   |       |      |         |         |   R×S   |         |         |         |
| :---: | :---: | :---: | :--: | :---: | :---: | :---: | :--: | :-----: | :-----: | :-----: | :-----: | :-----: | :-----: |
| **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |      | **R.X** | **R.Y** | **R.Z** | **S.X** | **S.Y** | **S.Z** |
|  x1   |  y1   |  z1   |      |  x1   |  y1   |  z2   |      |   x1    |   y1    |   z1    |   x1    |   y1    |   z2    |
|  x1   |  y3   |  z2   |      |  x1   |  y3   |  z2   |      |   x1    |   y1    |   z1    |   x1    |   y3    |   z2    |
|  x2   |  y3   |  z3   |      |  x2   |  y3   |  z3   |      |   x1    |   y1    |   z1    |   x2    |   y3    |   z3    |
|       |       |       |      |       |       |       |      |   x1    |   y3    |   z2    |   x1    |   y1    |   z2    |
|       |       |       |      |       |       |       |      |   x1    |   y3    |   z2    |   x1    |   y3    |   z2    |
|       |       |       |      |       |       |       |      |   x1    |   y3    |   z2    |   x2    |   y3    |   z3    |
|       |       |       |      |       |       |       |      |   x2    |   y3    |   z3    |   x1    |   y1    |   z2    |
|       |       |       |      |       |       |       |      |   x2    |   y3    |   z3    |   x1    |   y3    |   z2    |
|       |       |       |      |       |       |       |      |   x2    |   y3    |   z3    |   x2    |   y3    |   z3    |

### 投影（Projection）

关系R上的投影是从R中选择出若干属性列组成新的关系。

形式定义如下：

$$
\Pi_A(R) = \{t[A]|t \in R\}
$$

其中A为R中的属性列。是关系代数的基本操作。

例：对S关系，计算$\Pi_{3,1}(S)$

|       |   S   |       |      | **$\Pi_{3,1}(S)$** |       |
| :---: | :---: | :---: | :--: | :----------------: | :---: |
| **A** | **B** | **C** |      |       **C**        | **A** |
|   2   |   5   |   7   |      |         7          |   2   |
|   4   |   6   |   8   |      |         8          |   4   |
|   3   |   5   |   9   |      |         9          |   3   |



### 选择（Selection）

关系R上的选择操作是从R中选择符合条件的元组。

形式定义如下:
$$
\sigma_F(R)=\{t|t \in R \land F(t)=true\}
$$

其中：
- F表示选择条件，它是一个逻辑表达式，取逻辑值“真”或“假”。
- 逻辑表达式F的基本形式为：$XθY[φX \space θY…]$
- θ表示**比较运算符**：$≥、≤、>、<、=、≠$
- φ表示**逻辑运算符**：﹁(非)、∧(与)、∨(或)
- X、Y是属性名，属性名也可用它的序号代替(如1、2……)。

是关系代数的基本操作。

例：

|       |   R   |       |      |       | $\eth_{C>'6'}(R)$ |       |
| :---: | :---: | :---: | :--: | ----: | :---------------: | :---- |
| **A** | **B** | **C** |      | **A** |       **B**       | **C** |
|   2   |   4   |   6   |      |     3 |         5         | 7     |
|   3   |   5   |   7   |      |     4 |         6         | 8     |
|   4   |   6   |   8   |      |       |                   |       |

## 组合操作

### 交（Intersection）

设关系R和S具有相同的关系模式，R和S的交是由属于R又属于S的元组构成的集合，记为R∩S。
形式定义如下：
$$
R \cap S=\{t|t\in R \land t \in S\}
$$

关系的交可以用差来表示，即$R \cap S=R-(R-S)$。
关系的交操作对应于寻找两关系共有记录的操作，是一种关系查询操作。

例：

|       |   R   |       |      |       |   S   |       |      |       |  $R \cap S$  |       |
| :---: | :---: | :---: | :--: | :---: | :---: | :---: | :--: | :---: | :---: | :---: |
| **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |      | **X** | **Y** | **Z** |
|  x1   |  y1   |  z1   |      |  x1   |  y1   |  z2   |      |  x1   |  y3   |  z2   |
|  x1   |  y3   |  z2   |      |  x1   |  y3   |  z2   |      | x2 | y3 | z3 |
|  x2   |  y3   |  z3   |      |  x2   |  y3   |  z3   |      |       |       |       |



### 连接（Join）

连接也称为θ连接。它是从两个关系的笛卡尔积中选取属性间满足一定条件的元组。

记作：
$$
R {_{A \theta B}^{\space\space\Join}} S=\{\hat{t_rt_s}|t_r\in R∧t_s\in S\land t_r[A]\space θ\space t_s[B]\}
$$
连接运算从R和S的笛卡尔积R×S中选取（R关系）在A属性组上的值与（S关系）在B属性组上值满足比较关系θ的元组。

因此：
$$
R {_{A \theta B}^{\space\space\Join}} S=\sigma_{A\theta B}(R×S)
$$

#### 等值连接
等值连接是θ为”＝”的连接运算。它是从关系R与S的笛卡尔积中，选取A、B**属性值相等**的那些元组。
等值连接表示为：
$$
R {_{A=B}^{\space\space\Join}} S=\{\hat{t_rt_s}|t_r\in R∧t_s\in S∧t_r[A]=t_s[B]\}
$$
$$
为此：R {_{A=B}^{\space\space\Join}} S=\sigma_{A=B}(R×S)
$$

#### 自然连接
自然连接是一种特殊的等值连接，它要求**两个关系中进行比较的分量必须是相同的属性组**，并且要在结果中**把重复的属性去掉**。
即若R和S具有相同的属性组B，则自然连接可记作：
$$
R\Join S=\{\hat{t_rt_s}[\bar{B}]|t_r\in R∧t_s\in S∧t_r[A]=t_s[B]\}
$$
$$
为此：R\Join S=\Pi_{\bar{B}}(\sigma_{R.B=S.B}(R×S))
$$

<br/>

**例：**

|       |    关系R    |      |      | 关系S |       |
| ----: | :-----: | ---- | ---- | ----: | ----- |
| **A** | **B** | **C** |      | **B** | **E** |
|    a1 |   b1    | 5    |      |    b1 | 3     |
|    a1 |   b2    | 6    |      |    b2 | 7     |
|    a2 |   b3    | 8    |      |    b3 | 10    |
|    a2 |   b4    | 12   |      |    b4 | 2     |
|       |         |      |      |    b5 | 2     |

|      |      | $R {_{C<E}^{\space\space\Join}} S$ |      |      |
| :--: | :--: | :--------------------------------: | :--: | :--: |
|  A   | R.B  |                 C                  | S.B  |  E   |
|  a1  |  b1  |                 5                  |  b2  |  7   |
|  a1  |  b1  |                 5                  |  b3  |  10  |
|  a1  |  b2  |                 6                  |  b2  |  7   |
|  a1  |  b2  |                 6                  |  b3  |  10  |
|  a2  |  b3  |                 8                  |  b3  |  10  |

等值连接：
|       |         | $R {_{R.B=S.B}^{\space\space\space\space\Join}} S$ |         |       |
| :---: | :-----: | :------------------------------------------------: | :-----: | :---: |
| **A** | **R.B** |                       **C**                        | **S.B** | **E** |
|  a1   |   b1    |                         5                          |   b1    |   3   |
|  a1   |   b2    |                         6                          |   b2    |   7   |
|  a2   |   b3    |                         8                          |   b3    |  10   |
|  a2   |   b3    |                         8                          |   b3    |   2   |

自然连接：

|       | $R\Join S$ |       |      |
| ----: | ---------: | :---: | :--- |
| **A** |          B | **C** | E    |
|    a1 |         b1 |   5   | 3    |
|    a1 |         b2 |   6   | 7    |
|    a2 |         b3 |   8   | 10   |
|    a2 |         b3 |   8   | 2    |



### 除(Division)

> [!note|style:callout|label:概念引入|labelVisibility:visible|iconVisibility:visible]
>
>  **分量：**设关系模式为$R(A_1, A_2, …, A_n)$。它的一个关系设为R。
>
> $t\in R$表示t是R的一个元组。$t[A_i$]则表示元组t中相应于**属性$A_i$的一个分量**。
>
> **象集：**给定一个关系R(X，Z)，X和Z为属性组。
>
> 可以定义，当$t[X]=x$时，x在R中的象集为：$Z_x=\{t[Z]|t∈R,t[X]=x\}$
>
> 它表示R中属性组X上值为x的诸元组在Z上分量的集合。

**计算$R÷S$的操作步骤为：**

1. 将关系R和关系S的属性进行划分，即$R(X,Y)、S(Y,Z)$;
2. 若X的某个值x的像集$Y_x$包含S表中所有元组，则将x放入结果集中。

**说明：**
     除操作是同时从行和列角度进行运算。除操作适合于**包含“对于所有的/全部的”语句**的查询操作。

**例：**

|                   |         R         |                   |      |                  |        S         |       |      |  R÷S  |
| :---------------: | :---------------: | :---------------: | ---- | :--------------: | :--------------: | :---: | ---- | :---: |
|       **A**       |  $\color{red}B$   |  $\color{red}C$   |      |  $\color{red}B$  |  $\color{red}C$  | **D** |      | **A** |
| $\color{blue}a1$  | $\color{blue}b1$  | $\color{blue}c2$  |      | $\color{blue}b1$ | $\color{blue}c2$ |  d1   |      |  a1   |
| $\color{green}a2$ | $\color{green}b3$ | $\color{green}c5$ |      | $\color{blue}b2$ | $\color{blue}c1$ |  d1   |      |       |
|        a3         |        b4         |        c4         |      | $\color{blue}b2$ | $\color{blue}c3$ |  d2   |      |       |
| $\color{blue}a1$  | $\color{blue}b2$  | $\color{blue}c3$  |      |                  |                  |       |      |       |
|        a4         |        b6         |        c4         |      |                  |                  |       |      |       |
| $\color{green}a2$ | $\color{green}b2$ | $\color{green}c3$ |      |                  |                  |       |      |       |
| $\color{blue}a1$  | $\color{blue}b2$  | $\color{blue}c1$  |      |                  |                  |       |      |       |

在关系R中，A可以取四个值$\{a1, a2, a3, a4\}$

- a1的象集为$\{(b1,c2), (b2,c3), (b2,c1)\}$
- a2的象集为$\{(b3,c5), (b2,c3)\}$
- a3的象集为$\{(b4,c4)\}$
- a4的象集为$\{(b6,c4)\}$
- S在(B,C)上的投影为\{(b1,c2), (b2,c3), (b2,c1)\}
- 显然只有a1的象集$(B,C)_{a1}$包含S在$(B,C)$属性组上的投影，所以$R÷S=\{a1\}$